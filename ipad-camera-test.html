<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iPadç›¸æ©Ÿæ¸¬è©¦é é¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            color: white;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        .device-info {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .device-info h3 {
            margin-top: 0;
            color: #ffd700;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }
        
        .test-section h3 {
            margin-top: 0;
            color: #4CAF50;
        }
        
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #45a049;
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        .danger {
            background: #f44336;
        }
        
        .danger:hover {
            background: #da190b;
        }
        
        video {
            width: 100%;
            max-width: 500px;
            height: auto;
            border-radius: 10px;
            margin: 20px 0;
            background: #000;
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .success {
            background: rgba(76, 175, 80, 0.3);
            border: 1px solid #4CAF50;
        }
        
        .error {
            background: rgba(244, 67, 54, 0.3);
            border: 1px solid #f44336;
        }
        
        .warning {
            background: rgba(255, 193, 7, 0.3);
            border: 1px solid #ffc107;
        }
        
        .info {
            background: rgba(33, 150, 243, 0.3);
            border: 1px solid #2196F3;
        }
        
        .log {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .instructions {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .instructions h3 {
            color: #FFC107;
            margin-top: 0;
        }
        
        .instructions ol {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .instructions li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“± iPadç›¸æ©Ÿæ¸¬è©¦å·¥å…·</h1>
        
        <div class="instructions">
            <h3>ğŸ”§ æ¸¬è©¦æ­¥é©Ÿ</h3>
            <ol>
                <li>ç¢ºä¿æ‚¨åœ¨iPadä¸Šä½¿ç”¨Safariæˆ–Chromeç€è¦½å™¨</li>
                <li>é»æ“Šã€Œæª¢æ¸¬è¨­å‚™ä¿¡æ¯ã€æŸ¥çœ‹ç•¶å‰è¨­å‚™ç‹€æ…‹</li>
                <li>é»æ“Šã€Œæ¸¬è©¦ç›¸æ©Ÿæ¬Šé™ã€æª¢æŸ¥ç›¸æ©Ÿæ˜¯å¦å¯ç”¨</li>
                <li>é»æ“Šã€Œé–‹å•Ÿç›¸æ©Ÿã€æ¸¬è©¦ç›¸æ©Ÿç•«é¢é¡¯ç¤º</li>
                <li>å¦‚æœç•«é¢æ˜¯é»‘è‰²ï¼Œè«‹æŒ‰ç…§éŒ¯èª¤æç¤ºé€²è¡Œä¿®å¾©</li>
            </ol>
        </div>
        
        <div class="device-info">
            <h3>ğŸ“‹ è¨­å‚™ä¿¡æ¯</h3>
            <div id="deviceInfo">é»æ“Šã€Œæª¢æ¸¬è¨­å‚™ä¿¡æ¯ã€æŒ‰éˆ•...</div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ” ç›¸æ©Ÿæ”¯æŒæª¢æ¸¬</h3>
            <button onclick="detectDeviceInfo()">æª¢æ¸¬è¨­å‚™ä¿¡æ¯</button>
            <button onclick="testCameraSupport()">æ¸¬è©¦ç›¸æ©Ÿæ¬Šé™</button>
            <div id="cameraSupport" class="status" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“· ç›¸æ©Ÿç•«é¢æ¸¬è©¦</h3>
            <button onclick="startCamera()" id="startBtn">é–‹å•Ÿç›¸æ©Ÿ</button>
            <button onclick="stopCamera()" id="stopBtn" disabled>é—œé–‰ç›¸æ©Ÿ</button>
            <button onclick="capturePhoto()" id="captureBtn" disabled>æ‹ç…§æ¸¬è©¦</button>
            
            <video id="video" autoplay playsinline muted webkit-playsinline="true" style="display: none;"></video>
            <canvas id="canvas" style="display: none;"></canvas>
            
            <div id="cameraStatus" class="status" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“ æ¸¬è©¦æ—¥èªŒ</h3>
            <button onclick="clearLog()">æ¸…é™¤æ—¥èªŒ</button>
            <div id="log" class="log"></div>
        </div>
    </div>

    <script>
        let currentStream = null;
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const log = document.getElementById('log');
        
        function logMessage(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            log.textContent += logEntry;
            log.scrollTop = log.scrollHeight;
            console.log(message);
        }
        
        function clearLog() {
            log.textContent = '';
        }
        
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
            element.style.display = 'block';
        }
        
        function detectDeviceInfo() {
            const userAgent = navigator.userAgent;
            const isiPad = /iPad/i.test(userAgent);
            const isiPhone = /iPhone/i.test(userAgent);
            const isiOS = /iPhone|iPad|iPod/i.test(userAgent);
            const isSafari = /^((?!chrome|android).)*safari/i.test(userAgent);
            const isChrome = /Chrome/i.test(userAgent);
            
            const deviceInfo = `
                <strong>è¨­å‚™é¡å‹:</strong> ${isiPad ? 'iPad' : isiPhone ? 'iPhone' : 'å…¶ä»–'}<br>
                <strong>ä½œæ¥­ç³»çµ±:</strong> ${isiOS ? 'iOS' : 'å…¶ä»–'}<br>
                <strong>ç€è¦½å™¨:</strong> ${isSafari ? 'Safari' : isChrome ? 'Chrome' : 'å…¶ä»–'}<br>
                <strong>User Agent:</strong> ${userAgent}<br>
                <strong>æ”¯æ´getUserMedia:</strong> ${navigator.mediaDevices && navigator.mediaDevices.getUserMedia ? 'æ˜¯' : 'å¦'}<br>
                <strong>æ”¯æ´WebRTC:</strong> ${navigator.mediaDevices ? 'æ˜¯' : 'å¦'}
            `;
            
            document.getElementById('deviceInfo').innerHTML = deviceInfo;
            logMessage('è¨­å‚™ä¿¡æ¯æª¢æ¸¬å®Œæˆ');
            
            if (isiPad) {
                if (isSafari) {
                    showStatus('cameraSupport', 'âœ… iPad Safari - æ‡‰æ”¯æ´ç›¸æ©ŸåŠŸèƒ½', 'success');
                } else if (isChrome) {
                    showStatus('cameraSupport', 'âš ï¸ iPad Chrome - ç›¸æ©Ÿæ”¯æ´å¯èƒ½æœ‰é™', 'warning');
                } else {
                    showStatus('cameraSupport', 'â“ iPadå…¶ä»–ç€è¦½å™¨ - ç›¸æ©Ÿæ”¯æ´æœªçŸ¥', 'warning');
                }
            } else {
                showStatus('cameraSupport', 'â„¹ï¸ éiPadè¨­å‚™', 'info');
            }
        }
        
        async function testCameraSupport() {
            logMessage('é–‹å§‹æ¸¬è©¦ç›¸æ©Ÿæ”¯æ´...');
            
            try {
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    throw new Error('ç€è¦½å™¨ä¸æ”¯æ´getUserMedia API');
                }
                
                // æª¢æŸ¥å¯ç”¨çš„åª’é«”è¨­å‚™
                const devices = await navigator.mediaDevices.enumerateDevices();
                const videoDevices = devices.filter(device => device.kind === 'videoinput');
                
                logMessage(`æ‰¾åˆ° ${videoDevices.length} å€‹è¦–é »è¨­å‚™`);
                
                if (videoDevices.length === 0) {
                    throw new Error('æœªæ‰¾åˆ°ç›¸æ©Ÿè¨­å‚™');
                }
                
                // æ¸¬è©¦åŸºæœ¬çš„ç›¸æ©Ÿæ¬Šé™è«‹æ±‚
                const constraints = { video: { facingMode: 'user' } };
                logMessage('è«‹æ±‚ç›¸æ©Ÿæ¬Šé™...');
                
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                logMessage('ç›¸æ©Ÿæ¬Šé™ç²å–æˆåŠŸ');
                
                // æª¢æŸ¥æµä¸­çš„è¦–é »è»Œé“
                const videoTracks = stream.getVideoTracks();
                logMessage(`æ‰¾åˆ° ${videoTracks.length} å€‹è¦–é »è»Œé“`);
                
                if (videoTracks.length > 0) {
                    const track = videoTracks[0];
                    const settings = track.getSettings();
                    logMessage(`ç›¸æ©Ÿè¨­å®š: ${JSON.stringify(settings)}`);
                }
                
                // æ¸…ç†æ¸¬è©¦æµ
                stream.getTracks().forEach(track => track.stop());
                
                showStatus('cameraSupport', 'âœ… ç›¸æ©Ÿæ¬Šé™æ¸¬è©¦é€šé', 'success');
                logMessage('ç›¸æ©Ÿæ¬Šé™æ¸¬è©¦å®Œæˆ');
                
            } catch (error) {
                logMessage(`ç›¸æ©Ÿæ¬Šé™æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
                showStatus('cameraSupport', `âŒ ç›¸æ©Ÿæ¬Šé™æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
            }
        }
        
        async function startCamera() {
            logMessage('é–‹å§‹å•Ÿå‹•ç›¸æ©Ÿ...');
            
            try {
                const isiPad = /iPad/i.test(navigator.userAgent);
                const isiOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
                
                if (isiOS) {
                    logMessage('æª¢æ¸¬åˆ°iOSè¨­å‚™ï¼Œä½¿ç”¨å„ªåŒ–é…ç½®...');
                }
                
                // ç‚ºiPadä½¿ç”¨ç°¡åŒ–çš„ç´„æŸæ¢ä»¶
                const constraints = {
                    video: {
                        facingMode: 'user'
                    }
                };
                
                logMessage(`è«‹æ±‚ç›¸æ©Ÿæµï¼Œç´„æŸæ¢ä»¶: ${JSON.stringify(constraints)}`);
                currentStream = await navigator.mediaDevices.getUserMedia(constraints);
                
                logMessage('ç›¸æ©Ÿæµç²å–æˆåŠŸ');
                
                // è¨­ç½®è¦–é »å…ƒç´ 
                video.srcObject = currentStream;
                video.style.display = 'block';
                
                // ç‚ºiOSè¨­å‚™è¨­ç½®ç‰¹æ®Šå±¬æ€§
                if (isiOS) {
                    video.playsInline = true;
                    video.muted = true;
                    video.autoplay = true;
                    video.setAttribute('webkit-playsinline', 'true');
                    logMessage('è¨­ç½®iOSç‰¹æ®Šå±¬æ€§');
                }
                
                // ç›£è½è¦–é »äº‹ä»¶
                video.addEventListener('loadedmetadata', () => {
                    logMessage('è¦–é »å…ƒæ•¸æ“šåŠ è¼‰å®Œæˆ');
                    logMessage(`è¦–é »å°ºå¯¸: ${video.videoWidth}x${video.videoHeight}`);
                });
                
                video.addEventListener('play', () => {
                    logMessage('è¦–é »é–‹å§‹æ’­æ”¾');
                    showStatus('cameraStatus', 'âœ… ç›¸æ©Ÿç•«é¢é¡¯ç¤ºæˆåŠŸ', 'success');
                    document.getElementById('startBtn').disabled = true;
                    document.getElementById('stopBtn').disabled = false;
                    document.getElementById('captureBtn').disabled = false;
                });
                
                video.addEventListener('error', (e) => {
                    logMessage(`è¦–é »æ’­æ”¾éŒ¯èª¤: ${e.message}`, 'error');
                    showStatus('cameraStatus', `âŒ è¦–é »æ’­æ”¾éŒ¯èª¤: ${e.message}`, 'error');
                });
                
                // å˜—è©¦æ’­æ”¾è¦–é »
                try {
                    await video.play();
                    logMessage('è¦–é »æ’­æ”¾å‘½ä»¤åŸ·è¡ŒæˆåŠŸ');
                } catch (playError) {
                    logMessage(`è¦–é »æ’­æ”¾å¤±æ•—: ${playError.message}`, 'error');
                    
                    // å°æ–¼iPadï¼Œæä¾›è©³ç´°çš„éŒ¯èª¤ä¿¡æ¯
                    if (isiPad) {
                        showStatus('cameraStatus', 'âŒ iPadç›¸æ©Ÿç•«é¢é¡¯ç¤ºå¤±æ•—ã€‚è«‹å˜—è©¦ï¼š\n1. ç¢ºä¿å·²æˆäºˆç›¸æ©Ÿæ¬Šé™\n2. é—œé–‰å…¶ä»–ç›¸æ©Ÿæ‡‰ç”¨ç¨‹å¼\n3. é‡æ–°å•Ÿå‹•ç€è¦½å™¨\n4. åˆ‡æ›åˆ°Safariç€è¦½å™¨', 'error');
                    } else {
                        showStatus('cameraStatus', `âŒ ç›¸æ©Ÿç•«é¢é¡¯ç¤ºå¤±æ•—: ${playError.message}`, 'error');
                    }
                }
                
            } catch (error) {
                logMessage(`å•Ÿå‹•ç›¸æ©Ÿå¤±æ•—: ${error.message}`, 'error');
                
                let errorMessage = 'å•Ÿå‹•ç›¸æ©Ÿå¤±æ•—';
                if (error.name === 'NotAllowedError') {
                    errorMessage = 'ç›¸æ©Ÿæ¬Šé™è¢«æ‹’çµ•ã€‚è«‹åœ¨ç€è¦½å™¨è¨­å®šä¸­å…è¨±ç›¸æ©Ÿæ¬Šé™ã€‚';
                } else if (error.name === 'NotFoundError') {
                    errorMessage = 'æœªæ‰¾åˆ°ç›¸æ©Ÿè¨­å‚™ã€‚';
                } else if (error.name === 'NotReadableError') {
                    errorMessage = 'ç›¸æ©Ÿæ­£åœ¨è¢«å…¶ä»–æ‡‰ç”¨ç¨‹å¼ä½¿ç”¨ã€‚';
                } else {
                    errorMessage = `${errorMessage}: ${error.message}`;
                }
                
                showStatus('cameraStatus', `âŒ ${errorMessage}`, 'error');
            }
        }
        
        function stopCamera() {
            logMessage('é—œé–‰ç›¸æ©Ÿ...');
            
            if (currentStream) {
                currentStream.getTracks().forEach(track => {
                    track.stop();
                    logMessage('åœæ­¢è¦–é »è»Œé“');
                });
                currentStream = null;
            }
            
            video.style.display = 'none';
            video.srcObject = null;
            
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            document.getElementById('captureBtn').disabled = true;
            
            showStatus('cameraStatus', 'ç›¸æ©Ÿå·²é—œé–‰', 'info');
            logMessage('ç›¸æ©Ÿé—œé–‰å®Œæˆ');
        }
        
        function capturePhoto() {
            if (!video.videoWidth || !video.videoHeight) {
                logMessage('è¦–é »å°ºå¯¸ç„¡æ•ˆï¼Œç„¡æ³•æ‹ç…§', 'error');
                showStatus('cameraStatus', 'âŒ è¦–é »å°ºå¯¸ç„¡æ•ˆï¼Œç„¡æ³•æ‹ç…§', 'error');
                return;
            }
            
            logMessage('é–‹å§‹æ‹ç…§...');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            const dataUrl = canvas.toDataURL('image/png');
            
            // å‰µå»ºä¸‹è¼‰é€£çµ
            const link = document.createElement('a');
            link.download = `ipad-camera-test-${Date.now()}.png`;
            link.href = dataUrl;
            link.click();
            
            logMessage(`æ‹ç…§æˆåŠŸï¼Œåœ–ç‰‡å°ºå¯¸: ${canvas.width}x${canvas.height}`);
            showStatus('cameraStatus', 'âœ… æ‹ç…§æˆåŠŸï¼Œåœ–ç‰‡å·²ä¸‹è¼‰', 'success');
        }
        
        // é é¢åŠ è¼‰æ™‚è‡ªå‹•æª¢æ¸¬è¨­å‚™ä¿¡æ¯
        window.addEventListener('load', () => {
            logMessage('iPadç›¸æ©Ÿæ¸¬è©¦é é¢å·²åŠ è¼‰');
            detectDeviceInfo();
        });
    </script>
</body>
</html>
